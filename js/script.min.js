const src="./",now=new Date(Date.now());ettSekund=1e3;let nextSlide,timeoutLoop,slides={},sortedSlides=[],standardLength=20,changeSpeed=3e3,activeSlide=0,firstLoop=!0,paused=!1;function toggleFullScreen(){document.fullscreenElement||document.body.requestFullscreen()}function pause(e){0==paused?(clearTimeout(timeoutLoop),document.getElementById("pause").style.display="block",paused=!0):(changeSlide(activeSlide),document.getElementById("pause").style.display="none",paused=!1)}function lastData(){var e=new XMLHttpRequest;e.open("GET","./list"),e.onload=function(){200===e.status&&(updateSlides(JSON.parse(e.responseText)),sortSlides(),firstLoop&&(changeSlide(0),firstLoop=!1))},e.onerror=function(){},e.send()}function updateSlides(e){addSlides(e),removeSlides(e)}function addSlides(e){for(var t=0;t<e.length;t++){const i=e[t];if(!slides[i]){let e=berikSlide(i);e.end>now&&e.start<now&&(slides[i]=e)}}}function removeSlides(e){for(i in slides)(!e.includes(i)||slides[i].end<now||slides[i].start>now)&&delete slides[i]}function berikSlide(e){let t={filename:e,url:src+e,end:testAndFormatEndDate(e),start:testAndFormatStartDate(e),length:setLengthOfSlide(e),MIME:testMIME(e)};return t.DOM=genererDOM(t),t}function testAndFormatEndDate(e){let t=Date.parse(e.slice(0,10));return t=isNaN(t)?Date.now()+31536e8:t,t=new Date(t),t}function testAndFormatStartDate(e){let t=e.match(/[ \-]start(\d{4}-\d{2}-\d{2})[ \-]/);return t=t?t[1]:"2010-01-01",t=Date.parse(t),t=isNaN(t)?Date.now()-31536e8:t,t=new Date(t),t}function setLengthOfSlide(e){let t=/-len(\d+)-/,i=standardLength;return null!=e.match(t)&&(i=parseInt(e.match(t)[1],10)),i}function testMIME(e){switch(e.split(".").slice(-1)[0]){case"png":mime="image/png";break;case"PNG":mime="image/png";break;case"jpg":mime="image/jpeg";break;case"webp":mime="image/webp";break;case"mp4":mime="video/mp4";break;case"html":mime="text/html";break;default:mime=""}return mime}function genererDOM(e){"use strict";let t=document.createElement("div");switch(t.className="slide",e.MIME){case"text/html":t.innerHTML='<iframe src="./img/'+e.filename+'"></iframe><div class="transparentCover"></div>';break;case"video/mp4":t.innerHTML='<video width="1920" height="1080" muted preload><source src="img/'+e.filename+'" type="video/mp4"></video>';break;default:t.innerHTML="<div style=\"background-image: url('./img/"+e.filename+"')\"></div>"}return t}function sortSlides(){let e=[];for(let t in slides)"hvaskjer.html"!=t&&e.push(slides[t]);e.sort(((e,t)=>e.end-t.end));for(let t=e.length-1;t>=0;t--)e.splice(t+1,0,slides["hvaskjer.html"]);sortedSlides=e}function changeSlide(e){"use strict";activeSlide=e,nextSlide=sortedSlides[e+1]?e+1:0;let t,i,n,d=document.querySelector("#slides");firstLoop?(t=document.createElement("div"),d.appendChild(t),t.className="slide",t.id="prevSlide"):(t=d.querySelector("#prevSlide"),i=d.querySelector("#currentSlide"),n=d.querySelector("#nextSlide"),d.removeChild(t),t=i,t.id="prevSlide"),firstLoop?(i=sortedSlides[e].DOM.cloneNode(!0),d.appendChild(i)):i=n,i.id="currentSlide",playVideo(i),n=sortedSlides[nextSlide].DOM.cloneNode(!0),d.appendChild(n),n.id="nextSlide",timeoutLoop=setTimeout((function(){changeSlide(nextSlide)}),standardLength*ettSekund)}function playVideo(e){if("video/mp4"==e.mime){let t=e.querySelector("video");t.currentTime=0,t.play()}}lastData(),setInterval(lastData,60*ettSekund),document.body.addEventListener("click",toggleFullScreen),document.body.addEventListener("touchend",toggleFullScreen),document.body.addEventListener("dblclick",pause);