const src="./",now=new Date(Date.now());ettSekund=1e3;let nextSlide,timeoutLoop,expired,slides={},sortedSlides=[],standardLength=20,changeSpeed=3e3,activeSlide=0,firstLoop=!0,paused=!1;function toggleFullScreen(){document.fullscreenElement||document.body.requestFullscreen()}function doubleTouch(e){1===e.touches.length&&(expired&&e.timeStamp<=expired?(e.preventDefault(),pause(),expired=null):expired=e.timeStamp+400)}function pause(e){0==paused?(clearTimeout(timeoutLoop),document.getElementById("pause").style.display="block",paused=!0):(changeSlide(nextSlide),document.getElementById("pause").style.display="none",paused=!1)}function lastData(){var e=new XMLHttpRequest;e.open("GET","./list"),e.onload=function(){200===e.status&&(updateSlides(JSON.parse(e.responseText)),sortSlides(),firstLoop&&(changeSlide(0),firstLoop=!1))},e.onerror=function(){},e.send()}function updateSlides(e){addSlides(e),removeSlides(e)}function addSlides(e){for(var t=0;t<e.length;t++){const n=e[t];if(!slides[n]){let e=berikSlide(n);e.end>now&&e.start<now&&(slides[n]=e)}}}function removeSlides(e){for(i in slides)(!e.includes(i)||slides[i].end<now||slides[i].start>now)&&delete slides[i]}function berikSlide(e){let t={filename:e,url:src+e,end:testAndFormatEndDate(e),start:testAndFormatStartDate(e),length:setLengthOfSlide(e),MIME:testMIME(e)};return t.DOM=genererDOM(t),t}function testAndFormatEndDate(e){let t=Date.parse(e.slice(0,10));return t=isNaN(t)?Date.now()+31536e8:t,t=new Date(t),t}function testAndFormatStartDate(e){let t=e.match(/[ \-]start(\d{4}-\d{2}-\d{2})[ \-]/);return t=t?t[1]:"2010-01-01",t=Date.parse(t),t=isNaN(t)?Date.now()-31536e8:t,t=new Date(t),t}function setLengthOfSlide(e){let t=/-len(\d+)-/,n=standardLength;return null!=e.match(t)&&(n=parseInt(e.match(t)[1],10)),n}function testMIME(e){switch(e.split(".").slice(-1)[0]){case"png":mime="image/png";break;case"PNG":mime="image/png";break;case"jpg":mime="image/jpeg";break;case"webp":mime="image/webp";break;case"mp4":mime="video/mp4";break;case"html":mime="text/html";break;default:mime=""}return mime}function genererDOM(e){"use strict";let t=document.createElement("div");switch(t.className="slide",e.MIME){case"text/html":let n=document.createElement("iframe");n.src="./img/"+e.filename;let d=document.createElement("div");d.className="transparentCover",t.appendChild(n),t.appendChild(d);break;case"video/mp4":let i=document.createElement("video");i.setAttribute("width","1920"),i.setAttribute("height","1080"),i.setAttribute("muted",!0),i.setAttribute("preload",!0);let l=document.createElement("source");l.src="./img/"+e.filename,l.setAttribute("type","video/mp4"),i.appendChild(l),t.appendChild(i);break;default:let s=document.createElement("div");s.style.backgroundImage="url('./img/"+e.filename+"')",t.appendChild(s)}return t}function sortSlides(){let e=[];for(let t in slides)"hvaskjer.html"!=t&&e.push(slides[t]);e.sort(((e,t)=>e.end-t.end));for(let t=e.length-1;t>=0;t--)e.splice(t+1,0,slides["hvaskjer.html"]);sortedSlides=e}function changeSlide(e){"use strict";activeSlide=e,nextSlide=sortedSlides[e+1]?e+1:0;let t,n,d,i=document.querySelector("#slides");firstLoop?(t=document.createElement("div"),i.appendChild(t),t.className="slide",t.id="prevSlide"):(t=i.querySelector("#prevSlide"),n=i.querySelector("#currentSlide"),d=i.querySelector("#nextSlide"),i.removeChild(t),t=n,t.id="prevSlide"),firstLoop?(n=sortedSlides[e].DOM.cloneNode(!0),i.appendChild(n)):n=d,n.id="currentSlide",playVideo(n,e),d=sortedSlides[nextSlide].DOM.cloneNode(!0),i.appendChild(d),d.id="nextSlide",timeoutLoop=setTimeout((function(){changeSlide(nextSlide)}),standardLength*ettSekund)}function playVideo(e,t){if(e.querySelector("video")){let t=e.querySelector("video");t.currentTime=0,t.play()}}lastData(),setInterval(lastData,60*ettSekund),document.body.addEventListener("click",toggleFullScreen),document.body.addEventListener("touchend",toggleFullScreen),document.body.addEventListener("dblclick",pause),document.body.addEventListener("touchstart",doubleTouch);